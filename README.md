# 【 [Track Conductor](https://shamojismm.github.io/TrackConductor/top/index.html) 】

(↑からツールへ飛べます。)

*made by [@Shamoji_SMM](https://x.com/Shamoji_SMM)*

`Last Update: 2025/May/10`

このサイトは、スーパーマリオメーカー2内で製作される「**レール演奏**」の一部を自動化・補助するツールです。
また将来的に様々なリンクや資料を掲載するまとめサイトのようにできたらなと思っています。

なにか質問や報告等あれば製作者までお知らせください。

> This tool is being translated into English.  
> Please let me know if you have any suggestions for translating terms or sentences.

## 0. [旧ツール](https://shamojismm.github.io/TrackConductor/old/index.html)

新ツールとして2025年3月に公開する前の旧バージョンです。
現在新バージョンに移行できていない機能等がありますので必要な場合はお使いください。

## 1. [集音生成](https://shamojismm.github.io/TrackConductor/wiring/index.html)

主に**集音**を自動化します。

MIDIファイルを用意してツールにインポートする方法とメロディをツールに直接入力する方法があります。
前者を推奨していますが、MIDIファイルを準備できない場合には後者をお使いください。

### MIDIファイルを準備する場合

作りたいメロディを決めたら、

- MIDIエディターを開き、空のトラックにメロディを適当な位置に入力、または貼り付けます。  

<img width="70%" src="https://github.com/user-attachments/assets/d7e71555-8d4b-49b5-b360-cb9e7c252d3b">

- もしくは、以下のようにメロディの前後に「MMstart」「MMend」というコメントイベントを挿入します
(大文字小文字は気にしなくてよい)。

<img width="70%" src="https://github.com/user-attachments/assets/aa871025-7349-44f7-be71-d1e5bfaab692">

ノートの始点のみ読み取るので、ノートの長さが短かかったりしても構いません。

これでMIDIファイルの準備はOKですが、最後にメロディのある**トラック番号**を覚えてください。
画像だと上から3番目でトラック番号は3ですね。

MIDIファイルは保存してツールの方を開きます。

<img width="70%" src="https://github.com/user-attachments/assets/089ee0d3-0a90-4ccc-8a85-5037d990be35">

「ファイルを選択」から先ほどのMIDIファイルをアップロードし、
トラック番号を選択して「読み込み」を押すと、画像のように表に色々入力されるはずです。

### ツールに直接入力する場合

このメロディを入力していきます。

<img width="60%" src="https://github.com/user-attachments/assets/acdf8912-91bb-4f5b-a616-4d9bd37d6221">

表の3行目の左端を「n分符」にして、

<img width="100%" src="https://github.com/user-attachments/assets/cc690cd7-a6b4-4200-8612-2ecdfb4caa71">

3行目に**音の長さ**(音が鳴ってから次の音が鳴るまで)を○分符で、  
5行目に基準音からの**音の高さ**を入力します。

○分符では`8+16`や`2-16+32`のような簡単な足し算・引き算ができます。  
また、`4.`は付点4分符(=`4+8`)、`2..`は複付点2分符(=`2+4+8`)のように入力することもできます。  
なお全符は`1`です。小数点には対応してないのでご注意ください。

音の高さについて、今回は左端を`0`として入力していますが他の値にしても構いません。  
たとえば、左端を`-5`とした場合、左から `-5`, `-2`, `0`, `5`... となります。

---

ここからは共通です。

**集音タイプ**(羽あり/なしとスキン)を選びます。作りたいコースに合わせてください。    
作りやすさとしては 羽あり地上 > 羽あり水中 >羽なし地上 > 羽なし水中 です。  

**4分符長**を決めます。
単位は**フレーム**(f, 1/60秒)で、4拍子系なら以下の中から元の曲のBPMに近いものを選ぶとよいでしょう。

| BPM | 4分符長[f] | | BPM | 4分符長[f] |
| :-: | :-: | - | :-: | :-: | 
| 100.0 | 36.0 | | 141.2 | 25.5 |
| 109.1 | 33.0 | | 150.0 | 24.0 |
| 114.3 | 21.5 | | 160.0 | 22.5 |
| 120.0 | 30.0 | | 171.4 | 21.0 |
| 126.3 | 28.5 | | 200.0 | 18.0 |

任意のBPMにしたい場合は以下の式で求めることもできます。

```
BPM = 3600 / 4分符長[f]
4分符長[f] = 3600 / BPM
```

スクロール演奏に合わせたい場合はスクロールの1拍あたりのフレーム数にしてください。

次に**基準音**を設定します。  
マリオメーカー内の音の高さに対応していて、
MIDIファイルの方法なら最初の音、直接入力なら音高を`0`にした音の高さを選びます。

ここまでできたら**演奏**を押してみてください。  
正常に入力できていればメロディ通りに演奏されるはずです。

---

狙い通りの演奏になっていることを確認したら**ここまで計算**を押して次に進みます。

**読み込みタイプ**には
- **開始画面** ... 全て同時に読み込む。
- **自由落下** ... 地上なら`4[f/b]`、水中なら`16[f/b]`の遅さで上から下に読み込む。
- **縦スクロール** ... 任意の平均遅度で読み込む。
- **横スクロール** ... 任意の平均遅度もしくは1マスずつ指定した遅度で読み込む。

の4種類あります。

縦スクロールを選ぶと上向きを正として**平均遅度**を入力することができます。  
例えば上向きの高速スクロールなら`14.286`、地上での自由落下なら`-4`です。

横スクロールも縦スクロールと同様、右向きを正として平均遅度を入力できますが、
それに加えて**遅度循環**も入力できます。  
遅度循環は、例えば右向きの青ドクロなら`6, 7, 6, 6, 7`のように1マスずつ遅度を指定し、
`6,7,6,6,7, 6,7,6,6,7...`と循環する遅度を入力できます。  
1列目(左端の列)にかかる遅延を`0`とし、2列目以降 前の列からの遅延が`6,7,6,6,7... [f]`となります。  
正確な集音をしたい場合にはこちらの方が良いですが、平均でも普通はあまり気にならないでしょう。  

---

以下の画像を参考に集音レールの配置を決め、**着線パターン**を選択してください。

<img width="70%" src="https://github.com/user-attachments/assets/98350ddc-389b-4e91-a38b-bb6ed2cad6f5">

羽あり地上には`a`, `b`の区別があり他はありません。

さて、ここから本格的に集音していきます。  
**基準高さ**に、"最初に鳴る音"の集音レールまでの距離[b]を入力します。

<img width="30%" src="https://github.com/user-attachments/assets/fa575cf1-ca61-4067-bd6a-28d000b22349">

上図のように、間に入るコインの枚数+1 が距離(高さ)となります。  
もちろん距離が近いほどコンパクトになりますが、そのぶん集音がうまくいく確率も下がります。

ここまで入力出来たら、あとはいい集音ができる遅延を探す作業です。  
先ほどと同じ"最初に鳴る音"に与える遅延[f]を**基準遅延**に入れます。  
おおむね何もレールを追加しない状態での遅延が0だと思ってください。

まれに値がマイナスでうまくいくこともありますが、
羽あり地上だと基本的に30~120ぐらいでうまくいきます。  
羽の有無やスクロールの速さによっても変わってくるのでがんばって探してください。

基準遅延を入力すると `◎: 9, ○: 5, △: 1, ×: 1` のように、
各列が配置を見つけられたかの結果が返ってきます。
- **◎** ... 誤差なし。
- **○** ... ±1 [f]。
- **△** ... ±2 [f]。
- **×** ... それ超過、配線できない。

◎が多く、×がない集音を探しましょう。  △が多少あっても気にならないことがほとんどだと思います。

---

いい感じのが見つかったらいよいよ集音の作成に入っていきます。  
**全体像を表示/非表示**を押すと下のような楽器ブロックの全体像が表示されます。

<img width="70%" src="https://github.com/user-attachments/assets/f8d83bc4-3aea-4b21-9424-1c89e6a5e534">

全体像の各列または表の最下段のセルを押すと、
楽器ブロックのキーや集音レールからの高さが表示されます。  
それを参考にして楽器ブロックと集音レールを配置してください。

<img width="60%" src="https://github.com/user-attachments/assets/cccf4060-8b15-4b2e-961d-73202ea8460e">

こんな感じです。

全体像の各列または表の最下段のセルで、
各列の楽器ブロックを中心としたレールの配置が表示されます。  
あとはこれに従ってレールを置いていくだけですね。



<img width="65%" src="https://github.com/user-attachments/assets/4983f76e-27ff-4e38-987d-93de8caa3995">

- **↑ / ↓** ... 楽器ブロックの向き。
- **Rn** ... レールn本。
- **Gn** ... ギャップnブロック。
- **F** ... 上向きに飛ばす。
- **-** ... これの前が上側オプション、後が下側。

配置テキスト(↑G3R1-R1G1R2 など)を押すと左側に画像が表示されます。

そして...すべての列に配置するとこうなります。

<img width="60%" src="https://github.com/user-attachments/assets/73b7084d-fa7c-48d4-af0a-02be4651a78c">

今回は羽あり水中、(マリオの)自由落下集音で作ってみました。  
これでめでたく完成です。

# 2. レールループ生成
# 3. レールループ設計
# 4. グローバル音源集

---

# 用語集

- **f, フレーム**  
1/60秒。観測できるSMM2の時間最小単位。

- **b, ブロック**  
ゲーム内の1マス。

- **f/b, 遅度**  
単位距離を進むのにかかる時間を遅さといい、それに向きが加わったものが遅度。

- **集音**  
演奏に必要な楽器ブロック群を集めること。  
楽器ブロックを集める主に水平なレールを集音レール(配送レール)という。

- **着線**  
集音においては、楽器ブロックが集音レールに乗ること。

- **終端速度**  
エネミーが落下し、充分に加速しきったときの速度。

- **音源**  
楽器ブロックで鳴らすパーツ。

- **グローバル**  
プレイヤーがエリアのどこにいても消失しないようなエネミーの状態。  
それに近いものは準グローバルと言ったりする。

- **グローバルグラウンド(GG)**  
スネークブロックやレール上のブロックなど、グルーバルでその上に接しているエネミーもグローバルにするような性質を持つパーツ。

# 参考資料・理論

- **[ぜんまいメソッド(縦断線式集音)](https://www.youtube.com/watch?v=r1Lp6UY5NIc)**
- **[Global Music Guide](https://docs.google.com/document/d/1UDIb2rA35Rv3DkNeI-p1F2aBea9MUSOXHAmqrl1AlU0/)**
- **[レールループ周期表(羽あり地上)](https://docs.google.com/document/d/1Q-8_1f7C3F6GWwwpzpdGy1_V7GucipjsmTNJcg_5dwQ/)**
- **[曲線レールについて](https://www.youtube.com/watch?v=x0NCKZ62eLA)**
- **[縦断線式集音法によるレール演奏の設計](https://drive.google.com/file/d/1weXp44U6FBnwNdutBvv3uM4hxlOpGpgn/)**
- **[レールブロックの運動](https://docs.google.com/document/d/17eotTTTSGNSofpDnM20Cwa0V7lLu7w5BK4YLJgbzLEM/)**
- **[小型ドラムループの周期](https://docs.google.com/document/d/1B-mHSfjt4DzFWQLD5zPTOLHvM4I8Jq1X6B37-szSeqo/)**

# 他リンク

- **[演奏コース研究会](https://sites.google.com/view/loopingmusiclab/%E3%83%9B%E3%83%BC%E3%83%A0)**








